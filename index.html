<html>

<head>
<title>rebuild 2.22</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

<script src="scriptloader.js"></script>
<script src="scriptloader_glitchdungeon.js"></script>
<!--fallback for file managing and other server side js when running nodejs server instead of nw.js-->
<script src="http://localhost:8080/socket.io/socket.io.js"></script>
<script src="javascript/main.js"></script>

</head>


<body>
	<div id="level-architect-menu"></div>
	<canvas id="text-canvas" style="border:none;position:absolute;z-index:1;pointer-events:none;" width="640" height="480"></canvas>
    <canvas id="enchanted-canvas" style="border:none;position:absolute;z-index:0;" width="640" height="480"></canvas>
	<canvas id="background-canvas" style="border:none;position:absolute;z-index:-1;pointer-events:none;" width="640" height="480"></canvas>
	
	<div id="console">
		<div id="console_messages"></div>
		<div id="console_input_container">
			<span id="console_input_prompt">&nbsp;&nbsp;&gt;&nbsp;&nbsp;</span>
			<textarea id="console_input">a</textarea>
		</div>
	</div>
	
	<script>
		var NORMAL = 0;
		var RETURN = 1;
		var ERROR = 2;
	
		var messages = document.getElementById("console_messages");
		console.log = function(x, log_type){
			if (log_type === undefined) log_type = NORMAL;
			var message = document.createElement("div");
			message.className = "console_message";
			message.innerHTML = x;
			if (log_type === RETURN)
				message.style.color = "#aaaaaa";
			else if (log_type == ERROR){
				message.style.color = "#ff0000";
				message.style.fontWeight = "bold";
			}
			
			messages.appendChild(message);
		}
	
		var previous_inputs = [];
		var previous_inputs_index = 0;
		var input = document.getElementById("console_input");
		input.innerHTML = "";
		input.onkeydown = function(e){
			if (e.keyCode === 13 && !e.shiftKey){ //enter
				var text = this.value;
				previous_inputs.push(text);
				previous_inputs_index = previous_inputs.length;
				console.log(this.value);
				try{
					var result = eval.call(window, text);
					if (result !== undefined)
						console.log(eval.call(window, text), RETURN);
				}catch(e){
					console.log(e, ERROR);
				}
				this.value = "";
				e.preventDefault();
			}
			if (e.keyCode === 38){	//UP ARROW
				if (previous_inputs_index > 0){
					previous_inputs_index--;
					var text = previous_inputs[previous_inputs_index];
					this.value = text;
				}
			}
			if (e.keyCode === 40){ //DOWN ARROW
				if (previous_inputs_index < previous_inputs.length-1 && previous_inputs.length > 1){
					previous_inputs_index++;
					var text = previous_inputs[previous_inputs_index];
					this.value = text;
				}
			}
			e.stopPropagation();
		}
	</script>
	<script>
		window.onload = function(){
			glitchdungeon_loadScripts(main);
		}
	</script>
</body>
</html>
